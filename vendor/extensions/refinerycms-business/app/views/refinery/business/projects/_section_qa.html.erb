<table class="cc-table">
  <tbody>
  <tr>
    <th>Type</th>
    <td><%= section.section_type %></td>
  </tr>
  <tr>
    <th>Description</th>
    <td><%= section.description %></td>
  </tr>
  <tr>
    <th>Jobs</th>
    <td>
      <p>
        <%= section.quality_assurance_jobs.count %>
        <%= link_to 'View', refinery.quality_assurance_jobs_path(section_id: section.id) %>
      </p>
    </td>
  </tr>
  </tbody>
</table>

<% if page_role?(Refinery::Business::ROLE_INTERNAL_FINANCE) %>
  <% if section.quality_assurance_jobs.any? %>
    <%- total_days = 0.0 -%>
    <table>
      <thead>
      <tr>
        <th>Billable</th>
        <th>Date</th>
        <th>Allocated</th>
        <th>Job</th>
      </tr>
      </thead>
      <tbody>
      <% section.jobs_and_allocations.each_pair do |billable, allocations| %>
        <tr>
          <td><%= link_to billable.title, refinery.business_billable_path(billable) %></td>
          <td><%= billable.billable_date %></td>
          <td>
            <%= '%g' % (allocated = 100.0 * allocations[:jobs].count / allocations[:total_no_of_jobs]) %>%
            <%- total_days += allocated / 100.0 -%>
          </td>
          <td>
            <% allocations[:jobs].each_with_index do |job, i| %>
            <p><%= link_to job.title, refinery.quality_assurance_job_path(job) %></p>
            <% end %>
          </td>
        </tr>
      <% end %>
      </tbody>
      <tfoot>
      <tr>
        <th>&nbsp;</th>
        <th>&nbsp;</th>
        <th>Total of <%= '%g' % total_days %> billable days</th>
        <th>&nbsp;</th>
      </tr>
      </tfoot>
    </table>
  <% end %>
<% end %>
