<div class="grid-x grid-padding-x">
  <div class="cell">
    <h2><%= @company.label %></h2>
  </div>

  <% if page_role? Refinery::Business::ROLE_INTERNAL %>
    <% if @company.contact.present? %>
      <div class="cell medium-6">
        <%= render 'refinery/marketing/contacts/organisation', contact: @company.contact %>
      </div>
    <% end %>

    <div class="cell medium-6">
      <h5>Users</h5>
      <% if @company.users.any? %>
        <% @company.users.each do |user| %>
          <p>
            <%= user.full_name %>
            <span style="color: #999; font-size: 10px;">
              <% if user.current_sign_in_at.nil? %>
                has never signed in
              <% else %>
                last signed in <%= time_ago_in_words user.current_sign_in_at %> ago
              <% end %>
            </span>
          </p>
        <% end %>
      <% else %>
        <p class="not_present">There are no users with access to this company</p>
      <% end %>
    </div>
  <% end %>

  <% if (parcels = @company.parcels.recent).any? %>
    <div class="cell medium-6">
      <div class="card">
        <div class="card-divider">
          <h4>Recent parcels received by Happy Rabbit</h4>
        </div>

        <div class="card-section">
          <table class="display" cellspacing="0" style="width: 100%;">
            <thead>
            <tr>
              <th>Parcel Date</th>
              <th>Courier</th>
              <th>Air Waybill No</th>
              <th>Given To</th>
              <th>Description</th>
            </tr>
            </thead>

            <tfoot>
            <tr>
              <th>Parcel Date</th>
              <th>Courier</th>
              <th>Air Waybill No</th>
              <th>Given To</th>
              <th>Description</th>
            </tr>
            </tfoot>

            <tbody>
            <% parcels.each do |parcel| %>
              <tr>
                <td><%= parcel.parcel_date %></td>
                <td><%= parcel.courier %></td>
                <td><%= parcel.air_waybill_no %></td>
                <td><%= parcel.assigned_to.try(:full_name) %></td>
                <td><%= parcel.description %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <% if (shipments = @company.to_shipments.shipped.recent).any? %>
    <div class="cell medium-6">
      <div class="card">
        <div class="card-divider">
          <h4>Recent shipments sent by Happy Rabbit</h4>
        </div>

        <div class="card-section">
          <table class="display" cellspacing="0" style="width: 100%;">
            <thead>
            <tr>
              <th>From</th>
              <th>Date</th>
              <th>Courier</th>
              <th>Tracking No.</th>
              <th>Status</th>
              <th>Description</th>
            </tr>
            </thead>

            <tfoot>
            <tr>
              <th>From</th>
              <th>Date</th>
              <th>Courier</th>
              <th>Tracking No.</th>
              <th>Status</th>
              <th>Description</th>
            </tr>
            </tfoot>

            <tbody>
            <% shipments.each do |shipment| %>
              <tr>
                <td><%= shipment.from_contact_name %></td>
                <td><%= shipment.shipping_date %></td>
                <td><%= shipment.courier %></td>
                <td><%= shipment.tracking_number %></td>
                <td><%= shipment.status %></td>
                <td><%= shipment.description %></td>
              </tr>
            <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% end %>

  <div class="cell medium-6">
    <div class="card">
      <div class="card-divider">
        <h4>Projects</h4>
      </div>

      <div class="card-section">
        <table>
          <thead>
          <tr>
            <th></th>
            <th>Project Code</th>
            <th>Description</th>
            <th>Start Date</th>
            <th>End Date</th>
            <th>Status</th>
          </tr>
          </thead>
          <tbody>
          <% @company.projects.each do |project| %>
            <tr>
              <td>
                <%= link_to refinery.business_project_path(project) do %>
                  <i class="fa fa-arrow-right"></i>
                <% end %>
              </td>
              <td><%= project.code %></td>
              <td><%= project.description %></td>
              <td><%= project.start_date %></td>
              <td><%= project.end_date %></td>
              <td><%= project.status %></td>
            </tr>
          <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <% if @company.inspections.any? %>
    <%= render 'inspections_summary', inspections: @company.inspections %>
  <% end %>
</div>

<% content_for :javascripts do %>
  <%= javascript_include_tag 'charts' %>

  <script type="text/javascript">
    $(function(){

    });
  </script>
<% end %>