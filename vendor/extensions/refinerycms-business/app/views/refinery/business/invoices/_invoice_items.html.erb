<%= form_for invoice_items_build_form, url: refinery.build_business_invoice_path do |f| %>
  <div data-form-container="invoice-monthly-minimum" class="form-addable">
    <div class="form-addable-controls">
      <i class="fa fa-plus-square form-ctrl-add"></i>
    </div>

    <div class="form-addable-record">
      <%= render 'monthly_minimum_form', f: f, i: 0 %>
    </div>

    <% content_for :javascripts do %>
      <script type="text/javascript">
        var onAddForm = function() {
          $('.js_article_field').autocomplete({
            source: <%= ::Refinery::Business::Article.is_public.to_source %>
          });
        };

        $(function() {
          onAddForm();

          Addable.partials["invoice-monthly-minimum"] = {
            "attributes": { "__index__": <%= 1 %> },
            "template": "<%= escape_javascript render('monthly_minimum_form', i: '__index__', f: f) %>",
            "onAdd": onAddForm,
          };
        });
      </script>
    <% end %>
  </div>

  <p><%= submit_tag 'Build', class: 'button' %></p>
<% end %>

<table class="invoice_grid_table">
  <thead>
  <tr>
    <th>#</th>
    <th>Item Code</th>
    <th>Description</th>
    <th>Qty</th>
    <th>Unit Price</th>
    <th>Account</th>
    <th>Tax Rate</th>
    <th>Region</th>
    <th>Amount</th>
  </tr>
  </thead>
  <tbody>
  <% invoice.invoice_items.each do |invoice_item| %>
    <tr>
      <td><%= invoice_item.line_item_order %></td>
      <td><%= invoice_item.item_code %></td>
      <td><%= invoice_item.description %></td>
      <td><%= invoice_item.quantity %></td>
      <td><%= invoice_item.unit_amount %></td>
      <td><%= invoice_item.account_code %></td>
      <td><%= invoice_item.tax_type %></td>
      <td>&nbsp;</td>
      <td><%= invoice_item.line_amount %></td>
    </tr>
  <% end %>
  </tbody>
</table>
