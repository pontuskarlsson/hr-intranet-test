<% if page_role? ::Refinery::Business::ROLE_INTERNAL_FINANCE %>
  <% if invoice.is_managed %>
    <% if invoice.statement&.resource.present? %>
      <%= link_to 'View Statement', invoice.statement.resource.file.url, class: 'button' %>

    <% else %>
      <%= link_to 'View Statement', refinery.statement_business_invoice_path(invoice, format: :pdf), class: 'button' %>
    <% end %>

    <% if invoice.managed_status_is_draft? %>
      <div style="display: inline-block;">
        <%= button_to 'Submit for Approval', refinery.business_invoice_path(invoice), params: { :"invoice[managed_status]" => "submitted_for_approval", "set_status" => "1" }, method: :put, html: { confirm: 'Are you sure?' }, class: 'button' %>
      </div>

    <% elsif invoice.managed_status_is_submitted_for_approval? %>
      <div style="display: inline-block;">
        <%= button_to 'Approve Invoice', refinery.business_invoice_path(invoice), params: { :"invoice[managed_status]" => "approved", "set_status" => "1" }, method: :put, html: { confirm: 'Are you sure?' }, class: 'button' %>
      </div>

    <% elsif invoice.managed_status_is_approved? %>
      <div style="display: inline-block;">
        <%= button_to 'Issue Invoice', refinery.business_invoice_path(invoice), params: { :"invoice[managed_status]" => "issued", "set_status" => "1" }, method: :put, html: { confirm: 'Are you sure?' }, class: 'button' %>
      </div>

    <% end %>

  <% else %>
    <%= button_to 'Set as Managed', [refinery, :business, invoice], params: { :"invoice[is_managed]" => true }, class: 'button', method: :put, html: { confirm: 'Managing this Invoice will overwrite any changes made manually in Xero. Do you want to continue?' } %>
  <% end %>
<% end %>
