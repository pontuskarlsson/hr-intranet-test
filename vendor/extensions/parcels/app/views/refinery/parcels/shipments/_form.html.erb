<%- disabled = !@shipment.editable_by?(current_authentication_devise_user) -%>

<% if disabled %>
  <p class="italic">Can only be edited by <%= @shipment.assigned_to.username %></p>
<% end %>

<%= form_for [refinery, :parcels, @shipment] do |f| %>
  <div class="row">
    <div class="medium-6 columns">
      <%= f.fields_for :from_address do |from_form| %>
        <h2>From</h2>

        <div class="fields">
          <%= from_form.label :name %>
          <%= from_form.text_field :name, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :street1, 'Street' %>
          <%= from_form.text_field :street1, disabled: disabled %>
          <%= from_form.text_field :street2, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :city %>
          <%= from_form.text_field :city, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :state %>
          <%= from_form.text_field :state, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :zip %>
          <%= from_form.text_field :zip, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :country %>
          <%= from_form.text_field :country, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :phone %>
          <%= from_form.text_field :phone, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :email %>
          <%= from_form.text_field :email, disabled: disabled %>
        </div>
      <% end %>
    </div>

    <div class="medium-6 columns">
      <%= f.fields_for :to_address do |from_form| %>
        <h2>To</h2>

        <div class="fields">
          <%= from_form.label :name %>
          <%= from_form.text_field :name, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :street1, 'Street' %>
          <%= from_form.text_field :street1, disabled: disabled %>
          <%= from_form.text_field :street2, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :city %>
          <%= from_form.text_field :city, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :state %>
          <%= from_form.text_field :state, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :zip %>
          <%= from_form.text_field :zip, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :country %>
          <%= from_form.text_field :country, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :phone %>
          <%= from_form.text_field :phone, disabled: disabled %>
        </div>

        <div class="fields">
          <%= from_form.label :email %>
          <%= from_form.text_field :email, disabled: disabled %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="fields">
    <%= f.submit 'Save', class: 'button round tiny', disabled: disabled %>
  </div>
<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag '//ajax.googleapis.com/ajax/libs/jqueryui/1/themes/smoothness/jquery-ui.css' %>
<% end %>

<% content_for :javascripts do %>

  <script type="text/javascript">
    $(function(){
      $('.js_parcel_date_field').datepicker({ dateFormat: "yy-mm-dd" });
      $('.js_from_field').autocomplete({
        source: <%= ::Refinery::Marketing::Contact.select(:name).map(&:name).to_json.html_safe %>
      });
      <%- users = ::Refinery::Authentication::Devise::User.pluck(:username).to_json.html_safe -%>
      $('.js_to_field').autocomplete({
        source: <%= users %>
      });
      $('.js_given_to_field').autocomplete({
        source: <%= users %>
      });
    });
  </script>
<% end %>
