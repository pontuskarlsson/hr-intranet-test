<section class="contact-card">
  <% shipment.items.build if shipment.items.empty? %>

  <%= form_for shipment, url: [refinery, :shipping, shipment] do |f| %>
    <div data-form-container="shipment-items" class="form-addable">
      <div class="form-addable-controls">
        <i class="fa fa-plus-square form-ctrl-add"></i>
      </div>

      <% shipment.items.each_with_index do |item, i| %>
        <div class="form-addable-record">
          <%= render 'item_form', f: f, item: item, i: i+1 %>
        </div>
      <% end %>

      <% content_for :javascripts do %>
        <script type="text/javascript">
          $(document).ready(function() {
            Addable.partials["shipment-items"] = {
              "attributes": { "__index__": <%= shipment.items.length+1 %> },
              "template": "<%= escape_javascript render('item_form', item: ::Refinery::Shipping::Item.new, i: '__index__', f: f) %>",
            };
          });
        </script>
      <% end %>
    </div>
  <% end %>
</section>
