<%- disabled = !@parcel.editable_by?(current_refinery_user) -%>

<% if disabled %>
  <p class="italic">Can only be edited by <%= @parcel.assigned_to.full_name %> or <%= @parcel.received_by.full_name %></p>
<% end %>

<%= form_for @parcel, url: refinery.shipping_parcel_path(@parcel) do |f| %>
  <div class="grid-x grid-padding-x">
    <div class="medium-6 cell end">

      <div class="fields">
        <%= f.label :received_by_id %>
        <%= f.text_field :received_by_id, value: @parcel.received_by.full_name, disabled: true %>
      </div>

      <div class="fields">
        <%= f.label :parcel_date %>
        <%= f.text_field :parcel_date, class: 'js_parcel_date_field', disabled: disabled %>
      </div>

      <div class="fields">
        <%= f.label :from %>
        <%= f.text_field :from, class: 'js_from_field', disabled: disabled %>
      </div>

      <div class="fields">
        <%= f.label :courier %>
        <%= f.text_field :courier, disabled: disabled %>
      </div>

      <div class="fields">
        <%= f.label :air_waybill_no %>
        <%= f.text_field :air_waybill_no, disabled: disabled %>
      </div>

      <div class="fields">
        <%= f.label :to, 'Addressed To' %>
        <%= f.text_field :to, class: 'js_to_field', disabled: disabled %>
      </div>

      <div class="fields">
        <%= f.label :given_to %>
        <%= f.text_field :given_to, class: 'js_given_to_field', disabled: disabled %>
      </div>

      <div class="fields">
        <%= f.submit 'Save', class: 'button round tiny', disabled: disabled %>
      </div>

    </div>
  </div>
<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag '//ajax.googleapis.com/ajax/libs/jqueryui/1/themes/smoothness/jquery-ui.css' %>
<% end %>

<% content_for :javascripts do %>

  <script type="text/javascript">
    $(function(){
      $('.js_parcel_date_field').datepicker({ dateFormat: "yy-mm-dd" });
      $('.js_from_field').autocomplete({
        source: <%= ::Refinery::Marketing::Contact.pluck(&:name).to_json.html_safe %>
      });
      <%- users = ::Refinery::Authentication::Devise::User.pluck(:full_name).to_json.html_safe -%>
      $('.js_to_field').autocomplete({
        source: <%= users %>
      });
      $('.js_given_to_field').autocomplete({
        source: <%= users %>
      });
    });
  </script>
<% end %>
