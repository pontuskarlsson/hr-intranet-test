<h2>Services Notification - <%= Date.today.to_s %></h2>
<p><%= @notice %></p>

<%- updated_columns = @orders.values.map { |updates| updates[:updates].keys }.flatten.uniq -%>
<%- columns_in_order = WipSchedule::Excel::ALLOW_UPDATES.reject { |c| !updated_columns.include? c } -%>
<table border="1">
  <thead>
  <tr>
    <th>Order</th>
    <% columns_in_order.each do |col| %>
      <th><%= col %></th>
    <% end %>
    <th>System info</th>
  </tr>
  </thead>
  <tbody>
  <% @orders.each_pair do |order_id, order| %>
    <% if order[:updates].any? %>
      <tr>
        <td><%= order[:title] %></td>
        <% columns_in_order.each do |col| %>
          <td>
            <% if (col_updates = order[:updates][col]) %>
              <% if col_updates[:error] %>
                <span style="color: red;">
                  <%= col_updates[:error] %>
                </span>
              <% else %>
                From: <%= col_updates[:from] %><br/>
                To: <%= col_updates[:to] %>
              <% end %>
            <% else %>
              &nbsp;
            <% end %>
          </td>
        <% end %>
        <td>
          <% if order[:error] %>
            <span style="color: red;">
              <%= order[:error] %>
            </span>
          <% end %>
        </td>
      </tr>
    <% end %>
  <% end %>
  </tbody>
</table>
