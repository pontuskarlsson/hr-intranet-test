<% content_for :body do %>
  <h4>Register Sick Leave</h4>

  <%= render 'quick_form', sick_leave: ::Refinery::Employees::LeaveOfAbsence.new %>

  <h4 class="t2">All of your registered Sick Leave occasions <small><%= link_to 'Register Past/upcoming Sick Leave', refinery.new_employees_sick_leave_path %></small></h4>

  <table class="display js_sick_leaves_data_table" cellspacing="0" style="width: 100%;">
    <thead>
    <tr>
      <th>Start</th>
      <th>End</th>
      <th>Doctor's Note</th>
      <th>Action</th>
    </tr>
    </thead>

    <tfoot>
    <tr>
      <th>Start</th>
      <th>End</th>
      <th>Doctor's Note</th>
      <th>Action</th>
    </tr>
    </tfoot>

    <tbody>
    <tr>
      <td colspan="4">Loading, please wait...</td>
    </tr>
    </tbody>
  </table>
<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag '//ajax.googleapis.com/ajax/libs/jqueryui/1/themes/smoothness/jquery-ui.css' %>
  <%= stylesheet_link_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.css' %>
<% end %>

<% content_for :javascripts do %>
  <%= javascript_include_tag '//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js' %>
  <%= javascript_include_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.js' %>

  <script type="text/javascript">
    $(function(){
      $('.js_sick_leaves_data_table').dataTable({
        "scrollY":        "600px",
        "scrollCollapse": true,
        "paging":         false,
        "order":          [[ 0, "desc" ]],
        "data":           <%= @leave_of_absences.to_json(only: [:start_date, :end_date, :id], include: { doctors_note: { only: [], methods: [:url] } }).html_safe %>,
        "columns": [
          { data: "start_date" },
          { data: "end_date" },
          { data: "doctors_note", "render": function(data, type, row){ return (data === null || typeof data == 'undefined' ? '<a href="/portal/employees/sick_leaves/'+row.id+'/add_note" data-remote="true">Add Note</a>' : '<a href="'+data.url+'">Download</a>'); } },
          { data: "id", "render": function(data, type, row){
            var strDate = (row.end_date ? row.end_date : row.start_date);
            if((Date.now() - Date.parse(strDate)) / (1000*60*60*24) < 7){
              return '<a href="/portal/employees/sick_leaves/'+data+'/edit">Edit</a>, <a href="/portal/employees/sick_leaves/'+data+'" data-method="delete">Remove</a>';
            } else {
              return '<span style="font-style: italic; color: #999;">Cannot edit</span>';
            }
          } }
        ]
      });
    });
  </script>
<% end %>

<%= render '/refinery/content_page' %>
