<%= pie_chart @inspections.pass_rate_qty, thousands: ',', colors: ['#48A9A6', '#C1666B', '#D4B483'], id: chart_id %>

<% content_for :javascripts do %>
  <script type="text/javascript">
    $(function() {
      $(document).on('draw.dt', '#<%= source_table_id %>', function() {
        var $dt = $('#<%= source_table_id %>').dataTable();
        var chart = Chartkick.charts['<%= chart_id %>'];

        var data = $dt.api().rows({ search: 'applied' }).data().reduce(function(acc, dataRow) {
          var result = dataRow.result ||  'Unknown';
          acc[result] = (acc[result] || 0) + dataRow.po_qty;
          return acc;
        }, { 'Pass': 0, 'Reject': 0, 'Hold': 0 });
        chart.updateData(data);
      });
    });
  </script>
<% end %>
