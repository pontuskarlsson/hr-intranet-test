<%-
  page_images = @page.images.to_a
  resp_img_idx = 0
%>

<% @page.parts.each_with_index do |section, i| %>
  <%-
    background = section.slug[/bg_[a-z]+/]
    offset = section.slug['offset']
    class_name = case background
                 when 'bg_black' then 'black-section'
                 when 'bg_blue' then 'blue-section'
                 when 'bg_grey' then 'grey-section'
                 when 'bg_gold' then 'gold-section'
                 when 'bg_img' then 'bg-img-section'
                 when 'bg_whole' then 'bg-whole-section'
                 else ''
                 end
  %>
  <section id="section<%= i %>" class="section-<%= section.slug %> <%= section.slug['large'] ? 'large-section' : '' %> <%= class_name %>" <% if background =~ /bg_img|bg_whole/ && (bg_image = page_images.shift).present? %> style="background-image: url(<%= bg_image.image.url %>);"<% end %>>
    <div class="grid-container">
      <div class="grid-x grid-padding-x">

        <% if section.slug == 'integrations' %>
          <%= render 'refinery/pages/sections/integrations', page: @page, section: section %>

        <% elsif section.slug == 'clients' %>
          <%= render 'refinery/pages/sections/clients', page: @page, section: section %>

        <% elsif section.slug == 'submenu' %>
          <%= render 'refinery/pages/sections/submenu', page: @page, section: section %>

        <% elsif section.slug[/resp_img/] %>
          <% page_image = page_images.shift %>
          <div class="cell medium-6 small-order-1<% if resp_img_idx.even? %> medium-order-2<% end %>">
            <% if page_image.present? %>
              <%= image_tag page_image.image.url, class: 'resp-img' %>
            <% end %>
          </div>

          <div class="cell medium-6 small-order-2<% if resp_img_idx.even? %> medium-order-1<% end %>">
            <%=raw section.body %>
          </div>
          <%- resp_img_idx += 1 %>

        <% elsif section.slug[/resp_2_img/] %>
          <% page_image = page_images.shift %>
          <div class="cell medium-6 small-order-1<% if resp_img_idx.even? %> medium-order-2<% end %>">
            <% if page_image.present? %>
              <%= image_tag page_image.image.url, class: 'resp-img' %>
            <% end %>
          </div>

          <% page_image = page_images.shift %>
          <div class="cell medium-6 small-order-2<% if resp_img_idx.even? %> medium-order-1<% end %>">
            <% if page_image.present? %>
              <%= image_tag page_image.image.url, class: 'resp-img' %>
            <% end %>
          </div>

        <% elsif section.slug[/full_img/] %>
          <% page_image = page_images.shift %>
          <div class="cell">
            <% if page_image.present? %>
              <%= image_tag page_image.image.url, class: 'resp-img' %>
            <% end %>
          </div>

        <% elsif section.slug[/cen_img/] %>
          <% page_image = page_images.shift %>
          <div class="cell medium-6 medium-offset-3 end">
            <% if page_image.present? %>
              <%= image_tag page_image.image.url, class: 'resp-img' %>
            <% end %>
          </div>

        <% else %>
          <div class="cell">
            <%=raw section.body %>
          </div>
        <% end %>

      </div>
    </div>
  </section>
<% end %>
