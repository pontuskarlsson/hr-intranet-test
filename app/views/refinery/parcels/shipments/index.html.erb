<% content_for :body do %>
  <h4>Add Shipment</h4>

  <section class="add_shipment">
    <%= render 'quick_form', shipment: @shipment %>
  </section>

  <% if params[:view_all] == '1' %>
    <p>Currently showing all shipments. <%= link_to 'View only recent', refinery.parcels_shipments_path %>.</p>
  <% else %>
    <p>Currently showing recent shipments. <%= link_to 'View all', refinery.parcels_shipments_path(view_all: '1') %>.</p>
  <% end %>

  <section>
    <table class="display js_shipments_data_table" cellspacing="0" style="width: 100%;">
      <thead>
      <tr>
        <th>&nbsp;</th>
        <th>From</th>
        <th>To</th>
        <th>Courier</th>
        <th>Tracking No.</th>
        <th>Status</th>
        <th>Shipping Date</th>
      </tr>
      </thead>

      <tfoot>
      <tr>
        <th>&nbsp;</th>
        <th>From</th>
        <th>To</th>
        <th>Courier</th>
        <th>Tracking No.</th>
        <th>Status</th>
        <th>Shipping Date</th>
      </tr>
      </tfoot>

      <tbody>
      <tr>
        <td colspan="7">Loading data. Please wait...</td>
      </tr>
      </tbody>
    </table>
  </section>

<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.css' %>
<% end %>

<% content_for :javascripts do %>

  <%= javascript_include_tag '//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js' %>
  <%= javascript_include_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.js' %>

  <script type="text/javascript">
    $(function(){
      $('.js_shipments_data_table').dataTable({
        "scrollY":        "600px",
        "scrollCollapse": true,
        "paging":         false,
        "order":          [[ 6, "desc" ]],
        "data":           <%= @shipments.to_json(methods: [:from_contact_name, :to_contact_name, :display_status]).html_safe %>,
        "columns": [
          { data: "id", "width": 60, "render": function(data, type, row){ return ('<a href="<%= refinery.parcels_shipment_path('%%shipment_id%%') %>">View</a>').replace('%%shipment_id%%', data); } },
          { data: "from_contact_name" },
          { data: "to_contact_name" },
          { data: "courier", "width": 150 },
          { data: "tracking_number", "width": 150 },
          { data: "display_status", "width": 150 },
          { data: "shipping_date", "width": 150, "render": { "sort": function(data, type, row){ if(data){ return data; }else{ return new Date('2099-01-01') } } } }
        ]
      });
    });
  </script>
<% end %>

<%= render '/refinery/content_page' %>
