<% content_for :body do %>
  <h4>Add Parcel</h4>

  <section class="add_parcels">
    <%= render 'quick_form', parcel: @parcel %>
  </section>

  <% if @my_unsigned_parcels.any? %>
    <h4>You need to sign the following Parcels</h4>
    <%= render 'sign_parcel_list', parcels: @my_unsigned_parcels, allow_sign: true %>
  <% end %>

  <section>
    <table class="display js_parcels_data_table" cellspacing="0" style="width: 100%;">
      <thead>
      <tr>
        <th style="width: 7%;">&nbsp;</th>
        <th>Parcel Date</th>
        <th>From</th>
        <th>Courier</th>
        <th>Air Waybill No</th>
        <th>Addressed To</th>
        <th>Given To</th>
        <th>Description</th>
        <th>Status</th>
      </tr>
      </thead>

      <tfoot>
      <tr>
        <th>&nbsp;</th>
        <th>Parcel Date</th>
        <th>From</th>
        <th>Courier</th>
        <th>Air Waybill No</th>
        <th>Addressed To</th>
        <th>Given To</th>
        <th>Description</th>
        <th>Status</th>
      </tr>
      </tfoot>

      <tbody>
      <tr>
        <td colspan="8">Loading, please wait...</td>
      </tr>
      </tbody>
    </table>
  </section>

<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.css' %>
<% end %>

<% content_for :javascripts do %>

  <%= javascript_include_tag '//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js' %>
  <%= javascript_include_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.js' %>
  <%= javascript_include_tag 'refinery/parcels/parcels' %>

  <script type="text/javascript">
    $(function(){
      var dataTable = Refinery.Parcels.Parcels.parcelsDataTable;

      $('.js_parcels_data_table').dataTable({
        "scrollY":        "600px",
        "scrollCollapse": true,
        "paging":         false,
        "order":          [[ 1, "desc" ]],
        "data":           <%= @parcels.to_json(methods: [:given_to]).html_safe %>,
        "columns": [
          { data: "id",           "render": { "display": dataTable.columns.id }, width: '7%' },
          { data: "parcel_date" },
          { data: "from_name",    "render": { "display": dataTable.columns.from_name } },
          { data: "courier" },
          { data: "air_waybill_no" },
          { data: "to_name" },
          { data: "given_to" },
          { data: "description" },
          { data: "receiver_signed", "render": function(data, type, row) {
            if(data){
              return 'Signed';
            }else if(row.received_by_id == <%= current_refinery_user.id %> || row.assigned_to_id == <%= current_refinery_user.id %>){
              return ('<a href="<%= refinery.sign_parcels_parcel_path('%%parcel_id%%') %>" data-remote="true">Sign</a> or <a href="<%= refinery.pass_on_parcels_parcel_path('%%parcel_id%%') %>" data-remote="true">Give to</a>').replace(/%%parcel_id%%/g, row.id);
            }else{
              return 'Not signed';
            }
          } }
        ]
      });
    });
  </script>
<% end %>

<%= render '/refinery/content_page' %>
