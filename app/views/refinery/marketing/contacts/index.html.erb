<% content_for :body do %>
  <h1>Contacts</h1>

  <table class="display js_contacts_data_table" cellspacing="0" style="width: 100%;">
    <thead>
    <tr>
      <th>Name</th>
      <th>Code</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Country</th>
    </tr>
    </thead>

    <tfoot>
    <tr>
      <th>Name</th>
      <th>Code</th>
      <th>Email</th>
      <th>Phone</th>
      <th>Country</th>
    </tr>
    </tfoot>

    <tbody>
    <tr>
      <td colspan="5">Loading, please wait...</td>
    </tr>
    </tbody>
  </table>
<% end %>

<% content_for :stylesheets do %>
  <%= stylesheet_link_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.css' %>
<% end %>

<% content_for :javascripts do %>
  <%= javascript_include_tag '//cdn.datatables.net/1.10.2/js/jquery.dataTables.min.js' %>
  <%= javascript_include_tag '//cdn.datatables.net/plug-ins/a5734b29083/integration/foundation/dataTables.foundation.js' %>
  <%= javascript_include_tag '//cdn.datatables.net/plug-ins/f2c75b7247b/api/fnSetFilteringDelay.js' %>

  <script type="text/javascript">
    $(function(){
      $('.js_contacts_data_table').dataTable({
        "scrollY":        "600px",
        "scrollCollapse": true,
        "paging":         false,
        "data":           <%= @contacts.to_json(only: [:id, :name, :code, :is_organisation, :organisation_name, :organisation_id, :email, :phone, :mobile, :country]).html_safe %>,
        "columns": [
          { data: "name", "width": '30%', "render": function(data, type, row) {
            return ('<a href="<%= refinery.marketing_contact_path('%%contact_id%%') %>"><i class="fa fa-'+(row.is_organisation ? 'building' : 'user')+'"></i> '+data+'</a>').replace('%%contact_id%%', row.id); }
          },
          { data: "code", "width": '10%' },
          { data: "email" },
          { data: "phone", "render": function(data, type, row){
            if(typeof data == 'undefined' || data === null || data == ''){
              return row.mobile;
            }else{
              return data;
            }
          } },
          { data: "country", "width": '15%' }
        ]
      }).fnSetFilteringDelay();
    });
  </script>
<% end %>

<%= render '/refinery/content_page' %>
